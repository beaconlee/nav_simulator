# 地图与坐标系

作为仿真器的机器人运行环境，在导航算法中，并不知道建筑物的概念，输入就只是地图，所以，只要有一张地图就可以满足规划需求。

## nav2_map_server

map一般是通过建图工具进行生成，也可以通过绘图软件进行编辑。不管从哪里来的地图，我们关心的只有如何将地图加载并管理起来。

在ROS 2（Robot Operating System 2）中，nav2_map_server 是与导航和路径规划相关的一个包。它负责管理和提供地图数据，以供ROS 2导航堆栈（Navigation Stack）中的其他节点使用。以下是关于nav2_map_server的概念、介绍和使用方法的详细信息：

nav2_map_server 是ROS 2中的一个节点，用于加载、管理和发布地图数据。在移动机器人的导航任务中，地图是一个关键的组成部分，它描述了机器人所在环境的空间布局。地图通常以栅格地图（Grid Map）的形式表示，其中每个栅格代表一小块区域，并标识出障碍物、自由空间等信息。

nav2_map_server节点的主要功能包括：

- 加载地图： 它可以从文件系统中加载保存的地图文件，如图片格式的地图或地图元数据文件。

- 管理地图数据： 一旦地图加载到节点中，nav2_map_server可以将其存储在内存中，以供其他导航节点查询和使用。

- 发布地图数据： 通过ROS 2的地图数据消息，如nav_msgs/OccupancyGrid消息类型，nav2_map_server将地图数据发布到ROS 2网络中，以便导航堆栈中的其他节点（如路径规划器、感知节点等）使用。

使用方法：

- 安装和配置： 首先，确保您已经安装了ROS 2以及nav2_map_server包。您可能需要在ROS 2工作空间中构建该包（前面navigation2的安装就已经完成了该步骤）。

- 准备地图数据： 获取或创建您的地图数据。这可以是一个图片格式的栅格地图，或者其他适用的地图数据文件（会提供map相关文件到项目的map文件夹）。

- 启动nav2_map_server节点： 在终端中执行命令以启动nav2_map_server节点，指定地图文件的路径和相关参数：

```
ros2 run nav2_map_server map_server --ros-args -p map:=/path/to/your/map.yaml
```
其中/path/to/your/map.yaml是您地图的元数据文件的路径。

- 订阅地图数据： 在导航堆栈的其他节点（一般指costmap2D），您可以通过订阅nav_msgs/OccupancyGrid消息来获取地图数据，然后用于路径规划、感知等任务。
```
ros2 topic echo /map
```
通过以上命令，可以接收到地图数据，就说明功能一切正常，可以继续向下进行。

需要注意的是，nav2_map_server只是导航系统的一部分，用于提供地图数据。要实现完整的导航功能，您还需要使用其他导航堆栈的节点，如路径规划器、控制器等，以及适配您的机器人硬件和环境。

请参阅ROS 2文档和nav2_map_server包的官方文档以获取更详细的信息、配置选项和使用示例：[map server](https://navigation.ros.org/configuration/packages/configuring-map-server.html)

相关源码部分可以参考 [code](https://github.com/ros-planning/navigation2/tree/galactic/nav2_map_server)

## 坐标系

描述机器人与地图之间的坐标变换， 允许机器人系统中的不同组件在不同坐标系之间进行无缝的转换，以实现正确的坐标变换和传递。机器人通常由多个部件组成，例如传感器、执行器、末端执行器等，它们在不同的坐标系中工作。这些坐标系之间的关系可能是固定的，也可能是动态的。在导航功能里最小集合只需要map-->base_link之间的变化关系，中间还会插入一个odom坐标系用以位姿调整。

ROS中提供了一个专用工具集：[tf](https://github.com/ros/geometry) / [tf2](https://github.com/ros/geometry2)



## launch
目录
### map_server

### rviz

### tf
